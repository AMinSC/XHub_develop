# 워크플로우의 이름을 설정합니다.
name: Django CI

# 이 워크플로우는 main 브랜치에 push 또는 pull request 이벤트가 발생할 때 실행됩니다.
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

# 작업 목록을 정의합니다.
jobs:
  build:
    # 작업이 실행될 운영체제를 지정합니다. 여기서는 최신 버전의 Ubuntu를 사용합니다.
    runs-on: ubuntu-latest
    
    # 병렬 실행 전략을 설정합니다.
    strategy:
      max-parallel: 4
      # 여러 버전의 Python에서 테스트를 실행할 수 있습니다. 여기서는 Python 3.11만 사용합니다.
      matrix:
        python-version: [3.11]

    # 작업 단계를 정의합니다.
    steps:
    # 저장소의 코드를 체크아웃합니다.
    - uses: actions/checkout@v3

    # GitHub Secrets에서 환경 변수를 설정합니다.
    - name: Set environment variables from GitHub Secrets
      env:
        SECRET_KEY: ${{ secrets.SECRET_KEY }}
        DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
      run: |
        echo "SECRET_KEY=${SECRET_KEY}" >> $GITHUB_ENV
        echo "DB_PASSWORD=${DB_PASSWORD}" >> $GITHUB_ENV
    
    # 지정된 Python 버전을 설정합니다.
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v3
      with:
        python-version: ${{ matrix.python-version }}
    
    # 필요한 의존성을 설치합니다.
    - name: Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    # Django의 테스트를 실행합니다.
    - name: Run Tests
      run: |
        python manage.py test